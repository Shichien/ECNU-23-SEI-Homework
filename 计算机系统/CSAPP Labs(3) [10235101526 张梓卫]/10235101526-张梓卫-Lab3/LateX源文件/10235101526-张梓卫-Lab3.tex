% \date{May 14, 2024}
% \author{Deralive}
% \title{华东师范大学软件学院实验报告模板}
% 注意事项：编译两次，以确保目录、页码完整显示

\def\allfiles{}

%————————————多文件编译————————————%
% \ifx\allfiles\undefined
% 	    \begin{document}
% \else
% \fi

% Content

% \ifx\allfiles\undefined
% 	    \end{document}
% 	\else
% 	\fi
%—————————————————————————————————%

\documentclass[14pt,a4paper,UTF8,twoside]{article}

\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{geometry} 
\usepackage{ctex}
\usepackage{booktabs} % 表格库
\usepackage{titlesec} % 标题库
\usepackage{fancyhdr} % 页眉页脚库
\usepackage{lastpage} % 页码数库
\usepackage{listings} % 代码块包
\usepackage{xcolor}
\usepackage[hidelinks]{hyperref}
\usepackage{tikz}
\usepackage{tikz-qtree}
\usepackage{float} % 浮动体环境
\usepackage{subfigure} % 子图排版（多图时用）

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\date{} % 留空，以让编译时去除日期

%———————————————注意事项—————————————————%

% 1、如果编译显示失败，但没有错误信息，就是 filename.pdf 正在被占用
% 2、在文件夹中的终端使用 Windows > xelatex filename.tex 也可编译

%—————————————华东师范大学———————————————%

% 论文制作时须加页眉，页眉从中文摘要开始至论文末
% 偶数页码内容为：华东师范大学硕士学位论文，奇数页码内容为学位论文题目

%————————定义 \section 的标题样式————————%

% 注意：\chapter 等命令，内部使用的是 \thispagestyle{plain} 的排版格式
% 若需要自己加上页眉，实际是在用 \thispagestyle{fancy} 的排版格式
% 加上下面这一段指令，就能够让 \section 也使用 fancy 的排版格式
% 本质就是让目录、第一页也能够显示页眉、页脚

\fancypagestyle{plain}{
  \pagestyle{fancy}
}

\title{华东师范大学软件学院实验报告} % 模板
\titleformat{\section}
    {\normalfont\bfseries\Large} % 字体大小、字体系列（\bfseries 为加粗）
    {\thesection}{1em}{}


% 设置章节的中文格式
\renewcommand\thesection{\chinese{section} \hspace{0pt}}
\renewcommand\thesubsection{\arabic{subsection} \hspace{0pt}}
% \renewcommand\thesubsubsection{\alph{subsubsection} \hspace{0pt}} % 字母编号
% \hspace{0pt} 是为了确保在章节编号和章节题目之间不要有空格，使得排版更为美观
    
%—————————————页面基础设置———————————————%

\geometry{left=10mm, right=10mm, top=20mm, bottom=20mm}

%————————————设置页眉、页脚——————————————%

\pagestyle{fancy} % 设置 plain style 的属性

% 设置页眉

\fancyhead[RE]{\leftmark} % Right Even 偶数页右侧显示章名 \leftmark 最高级别章名
\fancyhead[LO]{\rightmark} % Left Odd 奇数页左侧显示节名 \rightmark 第二级别节名
\fancyhead[C]{华东师范大学软件学院实验报告} % Center 居中显示
\fancyhead[LE,RO]{~\thepage~} % 在偶数页的左侧，奇数页的右侧显示页码
\renewcommand{\headrulewidth}{1.2pt} % 页眉与正文之间的水平线粗细

% 设置页脚：在每页的右下脚以斜体显示书名

\fancyfoot[RO,RE]{\it Lab Report By \LaTeX} % 使用意大利斜体显示
\renewcommand{\footrulewidth}{0.5pt} % 页脚水平线宽度

% 设置页码：在底部居中显示页码

\pagestyle{fancy}
\fancyfoot[C]{\kaishu 第 \thepage 页 \ 共 \pageref{LastPage} 页} % LastPage 需要二次编译以获取总页数

%——————————————代码块设置———————————————%

\lstset {
    backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
    basicstyle=\footnotesize,        % the size of the fonts that are used for the code
    breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
    breaklines=true,                 % sets automatic line breaking
    captionpos=bl,                   % sets the caption-position to bottom
    commentstyle=\color{mygreen},    % comment style
    deletekeywords={...},            % if you want to delete keywords from the given language
    escapeinside={\%*}{*},           % if you want to add LaTeX within your code
    extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
    frame=single,                    % adds a frame around the code
    keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
    keywordstyle=\color{blue},       % keyword style
    % language=Python,               % the language of the code
    morekeywords={*,...},            % if you want to add more keywords to the set
    numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
    numbersep=5pt,                   % how far the line-numbers are from the code
    numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
    rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
    showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
    showstringspaces=false,          % underline spaces within strings only
    showtabs=false,                  % show tabs within strings adding particular underscores
    stepnumber=1,                    % the step between two line-numbers. If it's 1, each line will be numbered
    stringstyle=\color{orange},      % string literal style
    tabsize=2,                       % sets default tabsize to 2 spaces
    % title=Python Code              % show the filename of files included with \lstinputlisting; also try caption instead of title
}

% 注释掉的部分用于后续插入代码，参数可调整，格式如下：

% 1、直接插入
% \begin{lstlisting}[language = ? , title = { ? } ]
%       Your code here.
% \end{lstlisting}

% 2、文件插入
% \lstinputlisting[language = C , title = ?.c] {filename.c}

%———————————————字体设置————————————————%

% \setCJKmainfont{SimSun} % 设置正文罗马族的 CJK 字体
% \renewcommand{\normalsize}{\fontsize{12pt}{15pt}\selectfont} % 设置正文字号
\linespread{1.2}

%——————————————————————————————————————%

%——————————————导言区结束，进入正文部分———————————————%

%——————————————————————————————————————%

\begin{document}

\maketitle

\begin{center} % \extracolsep{\fill} 拉伸到页面最大宽度前，保证居中显示

  \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}} l  l  l }
    \hline
    实验课程：计算机系统 &  年级：2023级本科  &  实验成绩： \\
    实验名称：$ Lab3 - Attack \ Lab $ & 姓名：张梓卫 \\
    实验编号：（3） & 学号：10235101526 & 实验日期：2024/05/24 \\
    指导老师：肖波 & 组号： \\
    \hline
  \end{tabular*}

\end{center}

\tableofcontents % 目录也需要二次编译

\section{实验简介}

本实验是$ CSAPP $的实验$ Lab \ 3 $，主要内容是对缓冲区溢出攻击进行实验。
缓冲区溢出是一种常见的程序漏洞，攻击者通过向程序输入超出预设缓冲区大小的数据，覆盖程序的返回地址，从而控制程序的执行流程。
本实验通过实现一个简单的攻击程序，演示了缓冲区溢出攻击的原理。
本实验主要包括以下内容：
\begin{itemize}
  \item 编写一个简单的攻击程序，通过缓冲区溢出攻击修改程序的返回地址，控制程序的执行流程。
  \item 通过调试工具观察程序的内存布局，分析缓冲区溢出攻击的原理。
\end{itemize}

本实验的实验环境为$ x86-64 $的 $ Ubuntu 20.04.2 LTS $，实验报告使用 \LaTeX 撰写。

\section{实验前置准备}
\begin{itemize}

  \item 在$ Linux $ 下解压实验压缩包，进入实验目录。
    \begin{figure} [H]
    \centering
    \includegraphics[width=0.4\textwidth]{Decompression.png}
    \caption{解压文件成功}
\end{figure}

  \item 使用$ objdump -d ctarget > ctarget.s $获取汇编代码，本部分是使用注入代码（Code）进行攻击；
  \item 使用$ objdump -d rtarget > rtarget.s $获取汇编代码，本部分是面向返回编程（Return）。
  
\end{itemize}

需要使用到的部分命令简介：

\begin{table}[h!]
  \centering
  \begin{tabular}{|c|c|}
      \hline
      ./hew2raw <1.txt> p1.txt &  将攻击字符串转化为可读取格式  \\
      \hline
      gcc -c 1.s & 编译生成1.o文件   \\
      \hline
      objdump -d 1.o(or ctarget)>1.txt & 反汇编输出含机器码的语句 \\
      \hline
      ./ctarget -qi 1.txt &运行1.txt里的内容 \\
      \hline
      touch 1.txt & 创建1.txt文件 \\
      \hline
      gdb ctarget & 编译文件 \\ 
      \hline
      break *0x400000 & 在该地址处设置断点 \\
      \hline
  \end{tabular}
  \caption{命令列表}
\end{table}

\section{实验分析及过程}

\input{ctarget.tex}

\input{rtarget.tex}

\section{Result}
本次实验对我来说难度较大，
过程中有很多不明白的地方，
但在查阅资料的过程中收获了很多，
更加熟练的掌握了知识。主要是以下两部分：

\begin{itemize}
  \item 汇编语言和反汇编：
  \item 在实验中，objdump等工具将C代码反汇编成汇编代码，深入理解了汇编语言的结构和指令集。通过对比C代码和汇编代码，掌握了函数调用、参数传递、栈操作等基本概念。
  \item 栈和寄存器操作：
  \item 理解了函数调用过程中栈的使用，以及如何通过寄存器进行数据传递和运算。具体包括函数的调用约定（calling conventions）、栈帧的结构和维护等。
\end{itemize}

\end{document}